# FLOW GIá»šI Háº N THá»œI GIAN LÃ€M VIá»†C

## ğŸ“‹ Tá»”NG QUAN

Há»‡ thá»‘ng giá»›i háº¡n thá»i gian lÃ m viá»‡c Ä‘á»ƒ Ä‘áº£m báº£o ngÆ°á»i chÆ¡i nghá»‰ ngÆ¡i há»£p lÃ½:
- **Test Mode:** 12 phÃºt/ngÃ y, 84 phÃºt/tuáº§n
- **Production:** 12 giá»/ngÃ y, 84 giá»/tuáº§n

## ğŸ”„ FLOW HOáº T Äá»˜NG

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NGÆ¯á»œI CHÆ I Báº¤M "Báº®T Äáº¦U"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Kiá»ƒm tra dailyWorkHours    â”‚
         â”‚ >= MaxDailyHours?          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚           â”‚
            âœ… CHÆ¯A Äáº T    âŒ ÄÃƒ Äáº T
                  â”‚           â”‚
                  â–¼           â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ CHO PHÃ‰P   â”‚  â”‚ CHáº¶N & THÃ”NG BÃO:            â”‚
         â”‚ Báº®T Äáº¦U CA â”‚  â”‚ "Pháº£i Ä‘á»£i Ä‘áº¿n ngÃ y má»›i"      â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MÃ¡y hoáº¡t Ä‘á»™ng         â”‚
    â”‚ Sinh tiá»n má»—i 30s     â”‚
    â”‚ Penalty má»—i 1 phÃºt    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Kiá»ƒm tra má»—i giÃ¢y:       â”‚
    â”‚ totalDailyHours          â”‚
    â”‚ >= MaxDailyHours?        â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚           â”‚
     âœ… CHÆ¯A Äáº T    âŒ ÄÃƒ Äáº T
           â”‚           â”‚
           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ TIáº¾P Tá»¤C â”‚  â”‚ AUTO-STOP & THÃ”NG BÃO:  â”‚
    â”‚ LÃ€M VIá»†C â”‚  â”‚ "ÄÃ£ háº¿t giá» lÃ m viá»‡c"   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ dailyWorkHours = MAX    â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š BIáº¾N TRáº NG THÃI

### 1. `dailyWorkHours` (TÃ­ch lÅ©y trong ngÃ y)
- **Khá»Ÿi táº¡o:** 0
- **Cáº­p nháº­t:** Khi káº¿t thÃºc ca hoáº·c auto-stop
- **Reset:** Má»—i ngÃ y má»›i (00:00)
- **CÃ´ng thá»©c:** `dailyWorkHours += workDuration`

### 2. `totalWorkHours` (Thá»i gian ca hiá»‡n táº¡i)
- **Khá»Ÿi táº¡o:** 0 (khi báº¯t Ä‘áº§u ca)
- **Cáº­p nháº­t:** Má»—i giÃ¢y (trong thread)
- **Reset:** Má»—i khi báº¯t Ä‘áº§u ca má»›i
- **CÃ´ng thá»©c:** `(now - workStartTime) / 3600`

### 3. `totalDailyHours` (Tá»•ng thá»i gian trong ngÃ y)
- **KhÃ´ng lÆ°u trá»¯** (tÃ­nh toÃ¡n Ä‘á»™ng)
- **CÃ´ng thá»©c:** `dailyWorkHours + totalWorkHours`
- **DÃ¹ng Ä‘á»ƒ:** Kiá»ƒm tra giá»›i háº¡n trong thread

## ğŸ¯ CÃC TRÆ¯á»œNG Há»¢P

### TrÆ°á»ng há»£p 1: LÃ m viá»‡c bÃ¬nh thÆ°á»ng
```
dailyWorkHours = 0
Báº¯t Ä‘áº§u ca â†’ totalWorkHours = 0
LÃ m viá»‡c 5 phÃºt â†’ totalWorkHours = 0.083h
totalDailyHours = 0 + 0.083 = 0.083h < 0.2h âœ…
â†’ Tiáº¿p tá»¥c lÃ m viá»‡c
```

### TrÆ°á»ng há»£p 2: Háº¿t giá» (Auto-stop)
```
dailyWorkHours = 0
Báº¯t Ä‘áº§u ca â†’ totalWorkHours = 0
LÃ m viá»‡c 12 phÃºt â†’ totalWorkHours = 0.2h
totalDailyHours = 0 + 0.2 = 0.2h >= 0.2h âŒ
â†’ AUTO-STOP
â†’ dailyWorkHours = 0.2h (set chÃ­nh xÃ¡c)
```

### TrÆ°á»ng há»£p 3: Báº¥m start sau khi háº¿t giá»
```
dailyWorkHours = 0.2h (tá»« ca trÆ°á»›c)
Báº¥m "Báº¯t Ä‘áº§u" â†’ Kiá»ƒm tra: 0.2h >= 0.2h âŒ
â†’ CHáº¶N & THÃ”NG BÃO: "Pháº£i Ä‘á»£i Ä‘áº¿n ngÃ y má»›i"
```

### TrÆ°á»ng há»£p 4: NgÃ y má»›i
```
dailyWorkHours = 0.2h (tá»« hÃ´m qua)
NgÃ y má»›i â†’ Reset: dailyWorkHours = 0
Báº¥m "Báº¯t Ä‘áº§u" â†’ Kiá»ƒm tra: 0 < 0.2h âœ…
â†’ CHO PHÃ‰P lÃ m viá»‡c láº¡i
```

### TrÆ°á»ng há»£p 5: LÃ m nhiá»u ca trong ngÃ y
```
Ca 1: LÃ m 5 phÃºt â†’ dailyWorkHours = 0.083h
Ca 2: LÃ m 5 phÃºt â†’ dailyWorkHours = 0.166h
Ca 3: LÃ m 2 phÃºt â†’ dailyWorkHours = 0.2h (auto-stop)
Ca 4: Báº¥m start â†’ CHáº¶N (Ä‘Ã£ Ä‘áº¡t giá»›i háº¡n)
```

## ğŸ› ï¸ COMMANDS

### `/windturbine:reset` (Test only)
```lua
dailyWorkHours = 0
weeklyWorkHours = 0
â†’ Cho phÃ©p lÃ m viá»‡c láº¡i ngay láº­p tá»©c
```

### `/windturbine:info`
```lua
Hiá»ƒn thá»‹:
- HÃ´m nay: dailyWorkHours + totalWorkHours
- Tuáº§n nÃ y: weeklyWorkHours + totalWorkHours
- Ca hiá»‡n táº¡i: totalWorkHours
```

## âš ï¸ LÆ¯U Ã QUAN TRá»ŒNG

### 1. KhÃ´ng cho phÃ©p lÃ m viá»‡c láº¡i sau khi háº¿t giá»
- âŒ **SAI:** Cho phÃ©p start láº¡i â†’ Láº­p tá»©c auto-stop
- âœ… **ÄÃšNG:** Cháº·n ngay tá»« Ä‘áº§u â†’ ThÃ´ng bÃ¡o rÃµ rÃ ng

### 2. Set giÃ¡ trá»‹ chÃ­nh xÃ¡c khi auto-stop
- âŒ **SAI:** `dailyWorkHours += workDuration` (cÃ³ thá»ƒ > MAX)
- âœ… **ÄÃšNG:** `dailyWorkHours = Config.MaxDailyHours` (chÃ­nh xÃ¡c = MAX)

### 3. Reset totalWorkHours khi báº¯t Ä‘áº§u ca má»›i
- âŒ **SAI:** Giá»¯ nguyÃªn totalWorkHours tá»« ca cÅ©
- âœ… **ÄÃšNG:** `totalWorkHours = 0` (reset vá» 0)

### 4. ThÃ´ng bÃ¡o rÃµ rÃ ng cho ngÆ°á»i chÆ¡i
- âŒ **SAI:** "ÄÃ£ Ä‘áº¡t giá»›i háº¡n! HÃ£y nghá»‰ ngÆ¡i."
- âœ… **ÄÃšNG:** "ÄÃ£ Ä‘áº¡t giá»›i háº¡n! Pháº£i Ä‘á»£i Ä‘áº¿n ngÃ y má»›i Ä‘á»ƒ lÃ m viá»‡c tiáº¿p."

## ğŸ§ª TEST CHECKLIST

- [ ] LÃ m viá»‡c Ä‘á»§ 12 phÃºt â†’ Auto-stop vá»›i thÃ´ng bÃ¡o Ä‘Ãºng
- [ ] Báº¥m start sau khi háº¿t giá» â†’ Cháº·n vá»›i thÃ´ng bÃ¡o "Pháº£i Ä‘á»£i Ä‘áº¿n ngÃ y má»›i"
- [ ] DÃ¹ng `/windturbine:reset` â†’ Cho phÃ©p lÃ m viá»‡c láº¡i
- [ ] DÃ¹ng `/windturbine:info` â†’ Hiá»ƒn thá»‹ thÃ´ng tin Ä‘Ãºng
- [ ] NgÃ y má»›i â†’ Reset tá»± Ä‘á»™ng, cho phÃ©p lÃ m viá»‡c láº¡i
- [ ] LÃ m nhiá»u ca trong ngÃ y â†’ TÃ­ch lÅ©y Ä‘Ãºng thá»i gian
- [ ] Disconnect giá»¯a chá»«ng â†’ LÆ°u thá»i gian Ä‘Ãºng
- [ ] Thá»i gian hiá»ƒn thá»‹ trÃªn UI â†’ "ONLINE - Xh/12h" Ä‘Ãºng

## ğŸ“ Káº¾T LUáº¬N

Há»‡ thá»‘ng bÃ¢y giá» hoáº¡t Ä‘á»™ng Ä‘Ãºng logic:
1. âœ… **Cháº·n ngay tá»« Ä‘áº§u** khi Ä‘Ã£ háº¿t giá»
2. âœ… **ThÃ´ng bÃ¡o rÃµ rÃ ng** pháº£i Ä‘á»£i Ä‘áº¿n ngÃ y má»›i
3. âœ… **KhÃ´ng bá»‹ bug** thá»i gian khÃ´ng hiá»ƒn thá»‹
4. âœ… **KhÃ´ng bá»‹ bug** khÃ´ng sinh tiá»n
5. âœ… **CÃ³ command test** Ä‘á»ƒ kiá»ƒm tra nhanh
